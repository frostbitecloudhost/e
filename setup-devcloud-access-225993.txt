#!/bin/bash

# create .ssh folder if missing
if [ ! -d ~/.ssh ]; then
    echo Creating the ~/.ssh directory for SSH client configuration...
    mkdir ~/.ssh
else
    echo The ~/.ssh directory for SSH client configuration already exists.
fi

# create config file
echo Appending SSH connection configuration to ~/.ssh/config
cat << EOF >> ~/.ssh/config
################################################################################################
# oneAPI DevCloud SSH config
################################################################################################
Host devcloud
User u225993
IdentityFile ~/.ssh/devcloud-access-key-225993.txt
ProxyCommand ssh -T -i ~/.ssh/devcloud-access-key-225993.txt guest@ssh.devcloud.intel.com

Host devcloud.proxy
User u225993
Port 4022
IdentityFile ~/.ssh/devcloud-access-key-225993.txt
ProxyCommand ssh -T devcloud-via-proxy

# If you must route outgoing SSH connection via a corporate proxy,
# replace PROXY_HOSTNAME and PORT below with the values provided by
# your network administrator.
Host devcloud-via-proxy
User guest
Hostname ssh.devcloud.intel.com
IdentityFile ~/.ssh/devcloud-access-key-225993.txt
LocalForward 4022 c009:22
ProxyCommand nc -x PROXY_HOSTNAME:PORT %h %p
################################################################################################

################################################################################################
# DevCloud VSCode config
################################################################################################
Host devcloud-vscode
UserKnownHostsFile /dev/null
StrictHostKeyChecking no
Hostname localhost
User u225993
Port 5022
IdentityFile ~/.ssh/devcloud-access-key-225993.txt
################################################################################################

################################################################################################
# SSH Tunnel config
################################################################################################
Host *.aidevcloud
User u225993
IdentityFile ~/.ssh/devcloud-access-key-225993.txt
ProxyCommand ssh -T devcloud nc %h %p
LocalForward 5022 localhost:22
LocalForward 5901 localhost:5901
################################################################################################

EOF

# create private key file
echo Creating the private SSH key ~/.ssh/devcloud-access-key-225993.txt
echo Important: this file is your access key, keep it safe like you would a password.
cat << EOF > ~/.ssh/devcloud-access-key-225993.txt
-----BEGIN OPENSSH PRIVATE KEY-----
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
ydoFXin4vgxEEAAAAHdTIyNTk5MwECAwQ=
-----END OPENSSH PRIVATE KEY-----

EOF

# update permissions to the private key file
chmod 600 ~/.ssh/devcloud-access-key-225993.txt

echo Done! Now you can access Intel DevCloud by running 'ssh devcloud' or, if you are behind a proxy, 'ssh devcloud.proxy'
